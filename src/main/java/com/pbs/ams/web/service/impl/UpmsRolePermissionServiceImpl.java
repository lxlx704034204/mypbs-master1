package com.pbs.ams.web.service.impl;import com.alibaba.fastjson.JSONArray;import com.alibaba.fastjson.JSONObject;import com.pbs.ams.common.annotation.BaseService;import com.pbs.ams.common.base.BaseServiceImpl;import com.pbs.ams.web.mappers.UpmsRolePermissionMapper;import com.pbs.ams.web.model.UpmsRolePermission;import com.pbs.ams.web.model.UpmsRolePermissionExample;import com.pbs.ams.web.service.UpmsRolePermissionService;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import java.util.ArrayList;import java.util.List;/** * UpmsRolePermissionService实现 * Created by ams on 2017/8/16. */@Service@Transactional(rollbackFor = Exception.class)@BaseServicepublic class UpmsRolePermissionServiceImpl extends BaseServiceImpl<UpmsRolePermissionMapper, UpmsRolePermission, UpmsRolePermissionExample> implements UpmsRolePermissionService {    private static Logger _log = LoggerFactory.getLogger(UpmsRolePermissionServiceImpl.class);    @Autowired    UpmsRolePermissionMapper upmsRolePermissionMapper;    @Override    public int rolePermission(JSONArray datas, long id) { // long id, int id        List<Long> deleteIds = new ArrayList<Long>();  //   List<Integer> deleteIds = new ArrayList<>();        for (int i = 0; i < datas.size(); i ++) {            JSONObject json = datas.getJSONObject(i);            if (!json.getBoolean("checked")) {                deleteIds.add(json.getLongValue("id")); //.add(json.getIntValue("id"));            } else {                // 新增权限                UpmsRolePermission upmsRolePermission = new UpmsRolePermission();                upmsRolePermission.setRoleId(id);                upmsRolePermission.setPermissionId(json.getLongValue("id")); //.setPermissionId(json.getIntValue("id"));                upmsRolePermissionMapper.insertSelective(upmsRolePermission);            }        }        // 删除权限        if (deleteIds.size() > 0) {            UpmsRolePermissionExample upmsRolePermissionExample = new UpmsRolePermissionExample();            upmsRolePermissionExample.createCriteria()                    .andPermissionIdIn(deleteIds)                    .andRoleIdEqualTo(id);            upmsRolePermissionMapper.deleteByExample(upmsRolePermissionExample);        }        return datas.size();    }}